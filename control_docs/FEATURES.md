# Features

## Done
- [F-001] Hexagonal Architecture (Ports-and-Adapters) — domain/ports/adapters layers with DI container
- [F-002] Multi-LLM Port Protocols — ChatLLM protocol with Anthropic, OpenAI, Gemini adapters
- [F-003] Pydantic Settings Config — multi-provider env-driven configuration
- [F-004] LangGraph Workflow Orchestration — plan pipeline with parallel fan-out topology
- [F-005] FastAPI API Layer — routers package with CORS, streaming support
- [F-006] Domain Entities — StudyPlan, Material, Tutor, Curriculum, Accessibility, Run
- [F-007] Observability Foundation — structlog JSON logging + OTEL trace context
- [F-008] Database Layer — SQLAlchemy 2.x async + Alembic + UUID v7 + 11 tables
- [F-009] Multi-Embedding Service — Gemini/OpenAI adapters (1536d MRL default) + FakeEmbeddings
- [F-010] Vector Store — pgvector (HNSW) + ChromaDB + InMemoryVectorStore pluggable
- [F-011] Material Ingestion — chunk (512t/64 overlap), embed, and index educator-uploaded docs
- [F-012] RAG Query — retrieve relevant chunks for plan enrichment and tutoring
- [F-013] Curriculum Standards — BNCC (Brazil) + CCSS/NGSS (USA) with grade mapping
- [F-014] Frontend Dashboard — Next.js 16 with Glass Box AI pipeline viewer
- [F-015] WCAG AAA Design System — 9 persona themes via CSS custom properties
- [F-016] SSE Pipeline Streaming — 14 typed events with {run_id, seq, ts, type, stage, payload} envelope
- [F-017] Tutor Agents — LangGraph workflow (intent->search->respond->check), session mgmt, playbooks
- [F-018] i18n (Full Stack) — English, Portuguese (BR), Spanish via next-intl 4.8.2 + backend i18n data
- [F-019] Sign Language Input — MediaPipe hand landmarks for Libras (MVP: 4 gestures)
- [F-020] Sign Language Output — VLibras 3D avatar widget integration
- [F-021] Speech-to-Text — Whisper V3 Turbo via faster-whisper + OpenAI cloud STT
- [F-022] Text-to-Speech — ElevenLabs primary + FakeTTS for CI
- [F-023] OCR + Image Description — Opus 4.6 vision for auto alt-text + OCR processor
- [F-024] Persona Toggle — live content morphing with CSS var swap
- [F-025] Simulate Disability — Empathy Bridge (dyslexia, tunnel vision, color blindness)
- [F-026] Export Viewer — side-by-side original vs adapted comparison
- [F-027] Accessibility Twin — Tabbed View with diff highlights (ADR-044)
- [F-028] Score Gauge — radial chart 0-100 with color interpolation and spring animation
- [F-029] SmartRouterAdapter — rebalanced weights (0.25/0.25/0.25/0.15/0.10), hard overrides, rules|weighted mode
- [F-030] Docker Compose Stack — one-command local dev (API + DB + Redis + Frontend)
- [F-031] Demo Mode — curated inputs, 3 scenarios, cached golden path, DemoModeMiddleware
- [F-032] React Compiler 1.0 — auto-memoization enabled (ADR-045)
- [F-033] HTML Sanitization — DOMPurify 3.3.1 for safe export rendering (ADR-046)
- [F-034] Tutor ChatBlock — structured message components
- [F-036] Direct Anthropic Tool Calling in Executor — replaces Claude Agent SDK (ADR-048)
- [F-037] FakeLLM Test Adapter — deterministic outputs for CI, zero external LLM calls (ADR-051)
- [F-038] Tiered Quality Gate — mandatory structural checks + heuristic scoring (ADR-050)
- [F-039] Composite FK Tenant Safety — DB-level cross-tenant prevention (ADR-053)

- [F-040] Full Test Coverage — 1,993+ backend tests (1,743 runtime + 250 agents), 770+ frontend tests (90 suites)
- [F-041] Docker Compose Full Stack — API + DB + Redis + Frontend with healthchecks
- [F-042] GitHub Actions CI — lint, typecheck, test pipeline
- [F-043] SSE Event Replay — InMemoryReplayStore + RedisReplayStore (ZSET, score=seq, TTL 30min) for reconnection (ADR-054)
- [F-044] Terminal SSE Guarantee — RunContext async context manager ensures run.completed or run.failed (ADR-055)
- [F-045] ThemeContext MutationObserver — useThemeContext hook for Recharts/Canvas theme reactivity (ADR-058)
- [F-046] Web Worker Sign Language — sign-language-worker.ts runs MediaPipe/MLP off main thread (ADR-057)
- [F-047] VLibras Accessibility — aria-hidden when inactive, skip-link for keyboard users
- [F-048] Reduced Motion — prefers-reduced-motion OS sync + localStorage override in accessibility store
- [F-049] Low-Distraction Mode — React 19.2 Activity component in sidebar for animation suppression
- [F-050] SmartRouter Pure Decision — compute_route() extracted as pure function with RouteFeatures/RouteDecision
- [F-051] SSE Emitter Thread Safety — asyncio.Lock on emit for parallel LangGraph branches
- [F-052] Live API Integration Tests — @pytest.mark.live_llm for real Anthropic/OpenAI/Gemini/OpenRouter testing (65 live tests)
- [F-053] ailine_agents Package — Pydantic AI 1.58.0 typed agents + LangGraph workflows (ADR-059)
- [F-054] Pydantic AI Model Selection Bridge — SmartRouter tier -> Pydantic AI Model mapping
- [F-055] Custom Skill Registry — parse SKILL.md YAML frontmatter + markdown, SkillRegistry.scan_paths(), get_prompt_fragment() for agent system prompts
- [F-056] CCSS ELA Curriculum — Common Core English Language Arts K-8 standards (ccss_ela.json, 46 objectives)
- [F-057] Bloom's Taxonomy Filtering — bloom_level field on CurriculumObjective, filter in search API across all 4 curriculum systems
- [F-058] Libras STT ML Pipeline — training scaffold, TF.js MLP classifier, webcam->landmarks->gloss->LLM streaming
- [F-059] SKILL.md Frontmatter Migration — 11 skills migrated to metadata block with compatibility structure
- [F-060] Rate Limiter Middleware — sliding window, 429+Retry-After, X-RateLimit-* headers
- [F-061] Prometheus Metrics — /metrics endpoint (Counter, Histogram, text exposition)
- [F-062] Security Headers Middleware — CSP, X-Frame-Options, Referrer-Policy, Permissions-Policy
- [F-063] Request ID Middleware — X-Request-ID + structlog correlation
- [F-064] Tenant Context Middleware — JWT sub + X-Teacher-ID dev mode via contextvars
- [F-065] Input Sanitization — sanitize_prompt, validate_teacher_id, sanitize_metadata
- [F-066] Circuit Breaker — 5 fail -> 60s open -> half-open -> reset
- [F-067] Retry with Exponential Backoff — 3 attempts, factor 2.0, transient-only
- [F-068] Workflow Timeout — 300s max with graceful degradation
- [F-069] Idempotency Guard — duplicate plan generation prevention
- [F-070] DI Container Lifecycle — health_check, close, validate, OCR protocol
- [F-071] Observability Spans — span_context, timed_operation, log_llm_call, log_tool_execution
- [F-072] Dev-Mode Safety Guard — startup fail if production + dev mode
- [F-073] Readiness Probe — /health/ready (DB+Redis checks, degraded/ready)

### Sprint 13 — Final Polish & Wow Factor (Feb 13, 2026)
- [F-074] Agent Trace Viewer — GET /traces/{run_id}, LangGraph node execution timeline with inputs/outputs/time/tools/quality
- [F-075] SmartRouter Route Rationale — "Why this model?" payload in SSE stage.started events (task type, weighted scores, model selection reason)
- [F-076] QualityGate Hard Constraints — 4 deterministic validators (reading level, a11y adaptation, RAG citation, assessment item)
- [F-077] RAG-Grounded Quoting — 1-3 source quotes with doc title/section, confidence labels (high/medium/low)
- [F-078] Observability Judge Dashboard — GET /observability/dashboard (LLM provider, latency p50/p95, error rate, CB state, SSE counts, token usage/cost)
- [F-079] Standards Alignment Evidence — GET /observability/standards-evidence/{run_id} + teacher handout export with BNCC/CCSS/NGSS/Bloom
- [F-080] Theme Morphing Animation — CSS transition-colors 500ms on body for smooth accessibility theme switching
- [F-081] Magic Layout Tabs — Motion layoutId sliding active tab indicator
- [F-082] Skeleton Shimmer Loading — animate-pulse SkeletonCardGrid with React 19 Suspense fallbacks
- [F-083] Staggered Dashboard Entrance — Motion staggerChildren 0.12s sequential load animation
- [F-084] Bento Grid Dashboard — CSS Grid responsive layout (grid-cols-4) with semantic widget sizing
- [F-085] Streaming Typewriter Effect — Token-by-token SSE rendering with motion.div fade+slide in Tutor ChatBlock
- [F-086] Toast Notifications — sonner integration for AI action completion with undo capability
- [F-087] Interactive Empty States — text-balance typography with CTA buttons for empty lists
- [F-088] Webcam Active Ring — Confidence-based border glow on sign language recognition
- [F-089] Export Paper Fold — motion.article rotateY expand animation on Export Viewer
- [F-090] Degradation Panel — Demo-mode chaos simulation (Redis down, LLM timeout) with status banner
- [F-091] Privacy Data Panel — Data summary, retention policies, export/delete with LGPD/FERPA compliance display
- [F-092] Cognitive Load Meter — 3-factor heuristic (UI density 40%, reading level 35%, interactions 25%) with simplify suggestion
- [F-093] Agent Trace Viewer UI — Collapsible timeline component for LangGraph node visualization
- [F-094] SmartRouter Rationale Card UI — Expandable badge with 5 weight category breakdown
- [F-095] Observability Dashboard UI — Recharts latency sparkline, circuit breaker state, SSE event counts, token usage charts
- [F-096] Enhanced Error Boundary — Branded error.tsx with copy diagnostics, SSE reconnect state, focus management
- [F-097] Full i18n Coverage — All components localized across 3 locales (en, pt-BR, es) including exports, accessibility, observability
- [F-098] Playwright E2E Golden Paths — 3 specs (onboarding wizard, language switch, SSE streaming) + axe-core a11y audit
- [F-099] Judge Artifacts — Architecture diagram (8 Mermaid), feature map (6 areas), demo script (3-min "Meet Ana"), judge packet (1-page)

### Sprint 14 — State-of-the-Art Hardening (Feb 13, 2026)
- [F-100] JWT RS256/ES256 Verification — Full asymmetric JWT with JWKS support, algorithm pinning, iss/aud/exp/nbf validation
- [F-101] JWT Security Test Suite — 57 tests: forged tokens, expired, wrong aud/kid, replay, tenant impersonation
- [F-102] Prompt Injection Defenses — Document trust scoring, retrieval sanitization, instruction hierarchy in RAG
- [F-103] Structured Audit Logging — Admin actions, content access, auth events to structured log
- [F-104] OpenTelemetry Tracing — Spans for FastAPI/SQLAlchemy/LLM/pipeline/tool calls, OTLP export
- [F-105] RFC 7807 Problem Details — Unified error handler, application/problem+json, field-level validation errors
- [F-106] DB Pool Tuning — pool_size=10 + max_overflow=10 for SSE workload, HNSW m=16/ef_construction=128
- [F-107] Cache Headers — Curriculum API 1h cache (static standards data)
- [F-108] Container Refactoring — container.py 476→278 LOC split into core + adapters
- [F-109] Agent Eval Harness — 15 golden test sets (5 Planner + 5 QualityGate + 5 Tutor) with rubric scoring
- [F-110] Eval Rubric System — Multi-dimension scoring (accuracy/safety/pedagogy/structure), regression detection
- [F-111] RAG Provenance Diagnostics — RetrievalResult with confidence classification, RAGDiagnostics with answerability
- [F-112] RAG Diagnostics API — GET /rag/diagnostics/{run_id} + /recent with chunk provenance
- [F-113] Sign Language Worker Fix — MediaPipe feature-gated loading, TODO stubs replaced
- [F-114] Playwright webServer Config — Self-contained E2E (build + start + test)
- [F-115] Visual Regression Tests — 8 screenshot comparisons for key layouts
- [F-116] View Transitions API — CSS-based route morphing animations
- [F-117] Dynamic OG Images — next/og ImageResponse for shared lesson links
- [F-118] PWA Manifest — manifest.json, beforeinstallprompt, icons, shortcuts, service worker registrar
- [F-119] Recharts Keyboard Accessibility — Tab through data points, aria-live announcements
- [F-120] Optimistic UI — useOptimistic hook for quick interactions

## Backlog
- [F-035] Sign Language Post-MVP Path — SPOTER transformer + VLibrasBD NMT dataset (ADR-047)
